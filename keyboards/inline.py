import sqlite3
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.filters.callback_data import CallbackData
from aiogram.utils.keyboard import InlineKeyboardBuilder

con = sqlite3.connect("database.db")
cur = con.cursor()

class AdminHandler(CallbackData, prefix="admin"):
    value: str
    action: str = "_"

class RemoveItems(CallbackData, prefix="remove_item"):
    type: str
    id: int

admin_btns = [
    [InlineKeyboardButton(text="üè™ –ó–º—ñ–Ω–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó", callback_data=AdminHandler(value = "category").pack())],
    [InlineKeyboardButton(text="üõçÔ∏è –ó–º—ñ–Ω–∏—Ç–∏ —Ç–æ–≤–∞—Ä–∏", callback_data=AdminHandler(value = "lots").pack())],
    [InlineKeyboardButton(text="üë§ –ó–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞", callback_data=AdminHandler(value = "users").pack())],
]
admin_mk = InlineKeyboardMarkup(inline_keyboard=admin_btns)

setup_cut_btns = [
    [InlineKeyboardButton(text="‚ûï –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é", callback_data=AdminHandler(value = "category", action="add").pack())],
    [InlineKeyboardButton(text="‚ûñ –í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é", callback_data=AdminHandler(value = "category", action="remove").pack())],
    [InlineKeyboardButton(text="üìã –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π", callback_data=AdminHandler(value = "category", action="list").pack())],
    [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=AdminHandler(value = "back").pack())],
]
setup_cut_mk = InlineKeyboardMarkup(inline_keyboard=setup_cut_btns)

setup_lots_btns = [
    [InlineKeyboardButton(text="‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä", callback_data=AdminHandler(value = "lots", action="add").pack())],
    [InlineKeyboardButton(text="‚ûñ –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä", callback_data=AdminHandler(value = "lots", action="remove").pack())],
    [InlineKeyboardButton(text="üìã –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤", callback_data=AdminHandler(value = "lots", action="list").pack())],
    [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=AdminHandler(value = "back").pack())],
]
setup_lot_mk = InlineKeyboardMarkup(inline_keyboard=setup_lots_btns)

back_mk = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data=AdminHandler(value = "back").pack())],])

clear_state_mk = InlineKeyboardMarkup(
    inline_keyboard=[
        [InlineKeyboardButton(text="–°–∫–∞—Å—É–≤–∞—Ç–∏", callback_data=AdminHandler(value = "clear_state").pack())]]
    )

def remove_category_mk():
    builder = InlineKeyboardBuilder()
    categories_list = cur.execute("SELECT * FROM categories").fetchall()

    for category in categories_list:
        builder.add(InlineKeyboardButton
                    (text=category[1],
                    callback_data=RemoveItems(type="category", id = category[0]).pack()))

    builder.button(text="üîô –ù–∞–∑–∞–¥", callback_data=AdminHandler(value = "back").pack())
    builder.adjust(1)
    return builder.as_markup()

def categories_list_mk():
    builder = InlineKeyboardBuilder()
    categories_list = cur.execute("SELECT * FROM categories").fetchall()

    for category in categories_list:
        builder.add(InlineKeyboardButton(text=category[1], callback_data=AdminHandler(value = "category_click").pack()))

    builder.button(text="üîô –ù–∞–∑–∞–¥", callback_data=AdminHandler(value = "back").pack())
    builder.adjust(1)
    return builder.as_markup()